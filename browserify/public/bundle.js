(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
/*! diagramax | (c) Daniel Canedo Ramos | http://duhnnie.net | https://github.com/duhnnie/diagramax/#license */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Diagramax=e():t.Diagramax=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var s,n,r=i(3),o=i(4),a=0,h=0;t.exports=function(t,e,i){var c=e&&i||0,d=e||[],_=(t=t||{}).node||s,l=void 0!==t.clockseq?t.clockseq:n;if(null==_||null==l){var u=r();null==_&&(_=s=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==l&&(l=n=16383&(u[6]<<8|u[7]))}var g=void 0!==t.msecs?t.msecs:(new Date).getTime(),p=void 0!==t.nsecs?t.nsecs:h+1,v=g-a+(p-h)/1e4;if(v<0&&void 0===t.clockseq&&(l=l+1&16383),(v<0||g>a)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,h=p,n=l;var m=(1e4*(268435455&(g+=122192928e5))+p)%4294967296;d[c++]=m>>>24&255,d[c++]=m>>>16&255,d[c++]=m>>>8&255,d[c++]=255&m;var E=g/4294967296*1e4&268435455;d[c++]=E>>>8&255,d[c++]=255&E,d[c++]=E>>>24&15|16,d[c++]=E>>>16&255,d[c++]=l>>>8|128,d[c++]=255&l;for(var S=0;S<6;++S)d[c+S]=_[S];return e||o(d)}},function(t,e,i){i(2),t.exports=i(5)},function(t,e,i){"use strict";i.r(e),e.default=i.p+"./diagramax.css"},function(t,e){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var s=new Uint8Array(16);t.exports=function(){return i(s),s}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},function(t,e){for(var i=[],s=0;s<256;++s)i[s]=(s+256).toString(16).substr(1);t.exports=function(t,e){var s=e||0,n=i;return[n[t[s++]],n[t[s++]],n[t[s++]],n[t[s++]],"-",n[t[s++]],n[t[s++]],"-",n[t[s++]],n[t[s++]],"-",n[t[s++]],n[t[s++]],"-",n[t[s++]],n[t[s++]],n[t[s++]],n[t[s++]],n[t[s++]],n[t[s++]]].join("")}},function(t,e,i){"use strict";i.r(e),i.d(e,"Canvas",(function(){return we})),i.d(e,"Rectangle",(function(){return De})),i.d(e,"Circle",(function(){return me})),i.d(e,"Triangle",(function(){return Ce})),i.d(e,"Ellipse",(function(){return Se})),i.d(e,"COMMANDS",(function(){return it})),i.d(e,"VERSION",(function(){return Le}));var s=i(0),n=i.n(s);var r=class{static create(t="div"){return document.createElement(t)}static createSVG(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}static get type(){return"element"}get type(){return this.constructor.type}constructor(t){this._id=null,this._el=null,t={id:n()(),...t},this.setID(t.id)}setID(t){return this._id=t,this._el&&this._el.setAttribute("id",t),this}getID(){return this._id}trigger(){return this}_createElement(){return this._el.classList.add("diagramax"),this}getElement(){return this._el||this._createElement(),this._el}remove(){this._el&&(this._el.remove(),this._el=null)}},o={custom(t){throw new Error(t)},notImplemented(){this.custom("Not implemented.")},invalidParameter(){this.custom("Invalid paramameter")}};const a=t=>t.stopPropagation();var h=class{constructor(){this._allObject={},this._listeners=new Map}addListener(t,e,i=null,s=null){let n,r,a;switch(this._listeners.has(t)?n=this._listeners.get(t):(n=new WeakMap,this._listeners.set(t,n)),typeof e){case"function":a=this._allObject,r=e,s=i;break;case"object":a=e,r=i;break;default:o.invalidParameter()}const h=n.get(a)||[];return h.push({callback:r,scope:s}),n.set(a,h),this}hasEventListener(t,e,i=null,s=null){const n=this._listeners.get(t);let r,a,h;if(n){switch(typeof e){case"function":h=this._allObject,a=e,s=i;break;case"object":h=e,a=i;break;default:o.invalidParameter()}return r=n.get(h),!(!r||!r.find(t=>t.callback===a&&t.scope===s))}return!1}removeListener(t,e,i=null,s=null){const n=this._listeners.get(t);let r,a,h;if(n){switch(typeof e){case"function":h=this._allObject,a=e,s=i;break;case"object":h=e,a=i;break;default:o.invalidParameter()}r=n.get(h),r&&(r=r.filter(t=>!(t.callback===a&&t.scope===s)),n.set(h,r))}return this}dispatch(t,e,...i){let s=this._listeners.get(t);return s&&(i=[{type:t,target:e}].concat(i),s=(s.get(e)||[]).concat(s.get(this._allObject)||[]),s.forEach(t=>{t.callback.apply(t.scope||window,i)})),this}};const c=Object.freeze({products:{}});var d=class{constructor(t){t={...c,...t},this._products={},this.setProducts(t.products)}addProduct(t,e){this._products[t]&&o.custom("Product key already exists, use another key."),this._products[t]=e}setProducts(t){const e=Object.entries(t||{});e.length||o.custom("At least one product should be produced by this repository."),e.forEach(([t,e])=>{this.addProduct(t,e)})}};var _=class extends d{create(t,...e){this._products[t]||o.custom(`Product '${t}' is not registered.`);return new(0,this._products[t])(...e)}hasProductKey(t){return!!this._products[t]}getProductKey(t){let e;return e="function"==typeof t?Object.entries(this._products).find(([e])=>e===t):Object.entries(this._products).find(([t])=>t.constructor===t),e?e[0]:null}};function l(...t){const{context:e,evaluator:i,fn:s,defaultValue:n}=this;let r;return"function"==typeof i&&(r=i.call(e)),r?s.apply(e,t):n}var u=(t,e,i=null,s=null)=>l.bind({fn:t,evaluator:e,context:i,defaultValue:s});const g=Object.freeze({disabled:!1});function p(){return!this._disabled&&this._target}var v=class{constructor(t,e){this._target=t,(e={...g,...e}).disabled?this.disable():this.enable()}_bind(t){return u(t,p,this)}end(){}disable(){this._disabled=!0,this.end()}enable(){this._disabled=!1}getTarget(){return this._target}isDisabled(){return this._disabled}attach(){this.enable()}detach(){this.disable(),this._target=null}};const m={text:""};var E=class extends r{static get type(){return"diagramText"}constructor(t){super(t),this._text="",this._dom={},t={...m,...t},this.setText(t.text)}setText(t){if(this._text=t.toString().trim(),this._dom.textContainer){const{textContainer:e}=this._dom;this._text?e.textContent=t:e.innerHTML=""}}getText(){return this._text}_createElement(){const t=r.createSVG("text"),e=r.createSVG("tspan");return t.classList.add("text"),e.classList.add("text-container"),t.appendChild(e),this._dom.textContainer=e,this.setText(this._text),this._el=t,super._createElement()}};const S=Object.freeze({SELECT:"select",UNSELECT:"unselect"});var f=class extends v{constructor(t,e){super(t,e),this._isSelected=!1,this.start=this._bind(this.start),this._select=this._bind(this._select)}end(){this.unselect()}isSelected(){return this._isSelected}_select(t){if(!this._isSelected){const e=this._target;if(t(e)){const t=e.getCanvas();this._isSelected=!0,e._dom.mainElement.classList.add("selected"),e._componentUI.setActive(),t.dispatchEvent(S.SELECT,e)}}}unselect(){if(this._isSelected){const t=this._target,e=t.getCanvas();this._isSelected=!1,t._componentUI.setActive(!1),t._dom.mainElement.classList.remove("selected"),e.dispatchEvent(S.UNSELECT,t)}}start(){if(!this._isSelected){const t=this._target;t.getCanvas().selectItem(t)}}attach(){const{mainElement:t}=this._target._dom;t.setAttribute("tabindex",0),t.addEventListener("focus",this.start,!1)}detach(){const{mainElement:t}=this._target._dom;t.removeAttribute("tabindex"),t.removeEventListener("focus",this.start,!1),super.detach()}};const x=Object.freeze({DEFAULT:"default"});var y=new _({products:{[x.DEFAULT]:f}});var C=class extends v{constructor(t,e){super(t,e),this.onContextMenu=this._bind(this.onContextMenu)}onContextMenu(t){t.preventDefault(),t.stopPropagation(),this._target.onContextMenu(t)}attach(){const{_target:t}=this;let e;e=t instanceof w?t._getMainElement():t.getElement(),e.addEventListener("contextmenu",this.onContextMenu,!1),super.attach()}detach(){const{_target:t}=this;let e;e=t instanceof w?t._getMainElement():t.getElement(),e.addEventListener("contextmenu",this.onContextMenu,!1),super.detach()}};const b=Object.freeze({DEFAULT:0});var D=new _({products:{[b.DEFAULT]:C}});var P=class{constructor(t=null){this._attributes=new Map,t&&this.set(t)}set(...t){return"object"==typeof t[0]?Object.entries(t[0]).forEach(([t,e])=>this._attributes.set(t,e)):this._attributes.set(...t),this}get(t){return this._attributes.get(t)}has(t){return this._attributes.has(t)}delete(t){return this._attributes.delete(t)}clear(){this._attributes.clear()}toJSON(){const t={};return this._attributes.forEach((e,i)=>{t[i]=e},t),t}};const A={canvas:null,text:"",data:{},selectionBehavior:x.DEFAULT,contextMenuBehavior:b.DEFAULT},T=Object.freeze({REMOVE:"remove"});var w=class extends r{static get type(){return"diagramElement"}constructor(t){super(t),t={...A,...t},this._canvas=null,this._text=new E,this._dom={},this._data=new P,this._componentUI=this._getComponentUI(),this._selectBehavior=y.create(t.selectionBehavior,this),this._contextMenuBehavior=D.create(t.contextMenuBehavior,this),this.setText(t.text).setData(t.data)}_getComponentUI(){o.notImplemented()}_setCanvas(t){return null===t||t instanceof we||o.invalidParameter(),this._canvas!==t&&(this._canvas&&this.remove(),this._canvas=t),this}_addControl(t,e){this._componentUI.addControl(t,e)}select(){this._selectBehavior.start()}unselect(){this._selectBehavior.unselect()}isSelected(){return this._selectBehavior.isSelected()}remove(){const{_canvas:t}=this;return t&&(this.unselect(),this._componentUI.remove(),this._canvas=null,super.remove(),t.dispatchEvent(T.REMOVE,this)),this}getCanvas(){return this._canvas}setText(t){return this._text.setText(t),this._dom.title&&(this._dom.title.text=t),this}getText(){return this._text.getText()}trigger(t,...e){const i=this._canvas;return i&&i.dispatchEvent(t,this,...e),this}_getMainElement(){return this._createElement()._dom.mainElement}getBounds(){o.notImplemented()}onContextMenu(t){const e=this.getCanvas();e&&e._onElementContextMenu(t,this)}setData(...t){return this._data.set(...t),this}addData(t,e){return this._data.set(t,e),this}getData(t){return this._data.get(t)}hasData(t){return this._data.has(t)}deleteData(t){return this._data.delete(t)}clearData(){this._data.clear()}getAllData(){return this._data.toJSON()}toJSON(){return{id:this._id,type:this.type,text:this.getText(),data:this._data.toJSON()}}_createElement(){if(this._el)return this;const t=r.createSVG("g"),e=r.createSVG("g"),i=r.create("title");return i.textContent=this._text.getText(),e.setAttribute("cursor","pointer"),e.classList.add("main-element"),t.classList.add("element"),t.setAttribute("focusable",!1),t.append(e),t.append(i),t.append(this._text.getElement()),this._dom.mainElement=e,this._dom.title=i,this._el=t,this._selectBehavior.attach(),this._contextMenuBehavior.attach(),this.setID(this._id),super._createElement()}getUIHTML(){return this._componentUI.getElement()}};var L=class{constructor(t){this._receiver=t,this._before=null,this._after=null}execute(){o.notImplemented()}undo(){o.notImplemented()}};var O=class extends L{constructor(t,...e){super(t),this._before=t.getPosition(),this._after=e}execute(){this._receiver.setPosition(...this._after)}undo(){this._receiver.setPosition(this._before)}};var B=class extends L{constructor(t,e){super(t),this._before=t.getText(),this._after=e}execute(){this._receiver.setText(this._after)}undo(){this._receiver.setText(this._before)}};var I=class extends v{constructor(t,e){super(t,e),this._dragging=!1,this._grabbed=!1,this._onGrab=this._bind(this._onGrab),this.startDrag=this._bind(this.startDrag),this._onRelease=this._onRelease.bind(this)}disable(){super.disable(),this._getDraggableElement().forEach(t=>t.classList.remove("draggable"))}_onGrab(t){if(0!==t.button)return;const{clientX:e,clientY:i}=t;this._grabbed=!0,this._lastPosition=this._target.getCanvas().clientToCanvas({x:e,y:i}),this._getDraggableElement().forEach(t=>t.classList.add("grabbing"))}startDrag(t){this._dragging||(this._dragging=!0),this._target.getElement().classList.add("dragging")}updatePosition(t,e,i){}endDrag(t){t&&t.stopPropagation(),this._grabbed=!1,this._dragging=!1,this._target.getElement().classList.remove("dragging"),this._getDraggableElement().forEach(t=>t.classList.remove("grabbing"))}end(){this.endDrag()}_onRelease(){(this._grabbed||this._dragging)&&this.endDrag()}isDragging(){return this._dragging}_evaluate(){o.notImplemented()}_getDraggableElement(){return[this._target.getElement()]}attach(){super.attach(),this._getDraggableElement().forEach(t=>t.classList.add("draggable"))}},R={isInLine(t,e,i){const{x:s,y:n}=e,{x:r,y:o}=i,{x:a,y:h}=t;return s===r&&s===a?this.isInBetween(h,n,o):n===o&&n===h&&this.isInBetween(a,s,r)},getPathLength:(t,e)=>Math.abs(t.y-e.y)+Math.abs(t.x-e.x),movePoint(t,e,i){let{x:s,y:n}=t;return i===bt.X?s+=e:i===bt.Y&&(n+=e),{x:s,y:n}},getRelativeFactor:(t,e)=>t<e?1:t>e?-1:0,getMiddlePoint(t,e){const i=this.getPathLength(t,e),s=ee._getSegmentOrientation(t,e);let{x:n,y:r}=t;return s===bt.X?n+=i/2*this.getRelativeFactor(t.x,e.x):r+=i/2*this.getRelativeFactor(t.y,e.y),{x:n,y:r}},isInBetween(t,e,i){const s=Math.min(e,i),n=Math.max(e,i);return t>s&&t<n},getOverlappedDimensions(t,e){let i=!1,s=!1;return(t.left===e.left||t.right===e.right||this.isInBetween(e.left,t.left,t.right)||this.isInBetween(t.left,e.left,e.right))&&(i=!0),(t.top===e.top||t.bottom===e.bottom||this.isInBetween(e.top,t.top,t.bottom)||this.isInBetween(t.top,e.top,e.bottom))&&(s=!0),{x:i,y:s}},getDiff:(t,e)=>({x:e.x-t.x,y:e.y-t.y}),getNormalizedPosition(t,e){const{x:i,y:s}=this.getDiff(t,e);return{x:i?i/Math.abs(i):0,y:s?s/Math.abs(s):0}},areOverlapped(t,e){const{x:i,y:s}=this.getOverlappedDimensions(t,e);return i&&s},getBoundSizeAndPos(t){const e=t.right-t.left,i=t.bottom-t.top;return{x:t.left+e/2,y:t.top+i/2,width:e,height:i}},clamp(t,e,i){const s=Math.min(e,i),n=Math.max(e,i);return t>n?n:t<s?s:t},toPoint:(t,e)=>({x:t,y:e}),areSamePoint:(t,e)=>t.x===e.x&&t.y===e.y};var z=class extends r{static get type(){return"diagramUI"}constructor(t){super(),this._target=t||null,this._events=new Map,this._handleEvent=this._handleEvent.bind(this)}_handleEvent(t){const{target:e,type:i}=t,s=this._events.get(i).get(e);s&&(t.stopPropagation(),s.forEach(e=>e(t)))}_createEventMap(t){let e=this._events.get(t);e||(e=new WeakMap,this._events.set(t,e),this.getElement().addEventListener(t,this._handleEvent,!1))}_getListenersSet(t,e){this._createEventMap(t);const i=this._events.get(t);let s=i.get(e);return s||(s=new Set,i.set(e,s)),s}addControl(t,e){e&&Object.entries(e).forEach(([e,i])=>{const s=Array.isArray(i)?i.slice(0):[i],n=this._getListenersSet(e,t);s.forEach(t=>n.add(t))}),this.getElement().appendChild(t)}setActive(t=!0){t?this._el.classList.add("active"):this._el.classList.remove("active")}_createElement(){const t=r.createSVG("g");return t.classList.add("ui-layer"),this._el=t,super._createElement()}remove(){this._events.clear(),super.remove()}};let M;var N=class extends z{static get type(){return"shapeUI"}static createHandler({classNames:t=[],dataset:e={}}={}){M||(M=r.createSVG("circle"),M.classList.add("handler"));const i=M.cloneNode(!0);return(t=Array.isArray(t)?t:[t]).forEach(t=>i.classList.add(t)),Object.entries(e).forEach(([t,e])=>{i.dataset[t]=e}),i}constructor(...t){super(...t),this._handleTargetMove=this._handleTargetMove.bind(this),this._handleTargetResize=this._handleTargetResize.bind(this)}_updatePosition({x:t,y:e}){this._el&&this._el.setAttribute("transform",`translate(${t}, ${e})`)}_handleTargetResize(t,{currentPosition:e}){this._updatePosition(e)}_handleTargetMove(t,e){this._updatePosition(e)}_createElement(){super._createElement();const{_el:t,_target:e,_handleTargetMove:i}=this;return t.classList.add("shape-ui"),e.getCanvas()._dom.uiLayer.append(this._el),this._updatePosition(e.getPosition()),e.getCanvas().addListener(H.RESIZE,e,this._handleTargetResize),e.getCanvas().addListener(ft.POSITION_CHANGE,e,i),e.getCanvas().addListener(ft.DRAG,e,i),this}remove(){const{_target:t,_handleTargetMove:e}=this;t.getCanvas().removeListener(H.RESIZE,t,this._handleTargetResize),t.getCanvas().removeListener(ft.POSITION_CHANGE,t,e),t.getCanvas().removeListener(ft.DRAG,t,e),super.remove()}};const H=Object.freeze({START:"resizestart",RESIZE:"resize",END:"resizeend",SIZE_CHANGE:"size:change"}),G=0,k=1,j=2,U=3,V=4,X=5,F=6,W=7,Y={[G]:V,[k]:X,[j]:F,[U]:W,[V]:G,[X]:k,[F]:j,[W]:U},$=[{className:"nwse",direction:G},{className:"ns",direction:k},{className:"nesw",direction:j},{className:"ew",direction:W},{className:"ew",direction:U},{className:"nesw",direction:F},{className:"ns",direction:X},{className:"nwse",direction:V}];class K extends I{static isValidSize({top:t,right:e,bottom:i,left:s}){return e-s>=1&&i-t>=1}constructor(t,e){super(t,e),this._handlers=[],this._direction=null,this._centered=null,this._originalRatio=null,this._originalBound=null,this.endDrag=this.endDrag.bind(this),this._onTargetResize=this._bind(this._onTargetResize)}_onGrab(t){if(0!==t.button)return;const{target:e}=t,{_target:i}=this;super._onGrab(t),this._direction=Number(e.dataset.direction),i.getCanvas().setResizingShape(i)}startDrag(t,e){const{_target:i}=this,{width:s,height:n}=i.getSize();null===this._direction&&(this._direction=e.direction),this._originalRatio=s/n,this._originalBound=i.getBounds(),i._componentUI.setActive(),super.startDrag(t,e),i.getCanvas().dispatchEvent(H.START,i)}endDrag(t){if(this._dragging){const{_target:e}=this,i=e.getCanvas(),s=e.getSize(),n=e.getCurrentSize();s.width===n.width&&s.height===n.height||i.executeCommand(it.SHAPE_RESIZE,e,e.getCurrentSize(),this._centered?null:this._direction),this._direction=null,this._centered=null,this._originalBound=null,this._originalRatio=null,this._updateHandlers(),super.endDrag(t),i.setResizingShape(null),i.dispatchEvent(H.END,e)}}_updateHandlers(){const{width:t,height:e}=this._target.getCurrentSize(),i=[-1,0,1],s=.5*t,n=.5*e;let r=0;[-1,0,1].forEach(t=>{i.forEach(e=>{if(!e&&!t)return;const i=this._handlers[r],o=s*e,a=n*t;i&&(i.setAttribute("cx",o),i.setAttribute("cy",a)),r+=1})})}_getNewBounds({x:t,y:e},i){const s={...this._originalBound};switch(i){case W:case G:case F:s.left=t;break;case U:case j:case V:s.right=t}switch(i){case k:case G:case j:s.top=e;break;case X:case F:case V:s.bottom=e}return s}_getModifiedBounds(t,e,i){const s={...t};if(e.shiftKey){const e=t.right-t.left,n=t.bottom-t.top,r=t.left+e/2,o=t.top+n/2,a=this._originalRatio;let h=e,c=n;const d=[W,U],_=[k,X];let l=null,u=null;if(d.includes(i)||_.includes(i))d.includes(i)?c=e/a:h=a*n;else{const t=e/n;a>1&&t>1||a<1&&t<1?a>t?c=e/a:h=a*n:a>1?c=e/a:h=a*n}switch(l=h/2,u=c/2,i){case k:s.left=r-l,s.right=r+l;case G:case j:s.top=s.bottom-c;break;case X:s.left=r-l,s.right=r+l;case F:case V:s.bottom=s.top+c}switch(i){case W:s.top=o-u,s.bottom=o+u;case G:case F:s.left=s.right-h;break;case U:s.top=o-u,s.bottom=o+u;case j:case V:s.right=s.left+h}}return s}_isCentered(t){return t.altKey}updatePosition(t,e,i){if(null===this._direction)return;const{_target:s}=this,n=this._direction,r=this._getNewBounds(t,n),o=this._getModifiedBounds(r,i,n);if(!K.isValidSize(o))return;const{width:a,height:h}=R.getBoundSizeAndPos(o);switch(n){case W:case U:s._updateWidth(a);break;case k:case X:s._updateHeight(h);break;default:s._updateSize(a,h)}if(this._centered=this._isCentered(i),this._centered){const{x:t,y:e}=R.getBoundSizeAndPos(this._originalBound);s.setPosition(t,e)}else s.align(o,Y[n]);super.updatePosition(t),s.getCanvas().dispatchEvent(H.RESIZE,s,{currentSize:{width:a,height:h},currentPosition:s.getCurrentPosition()})}_evaluate(t){return t}_onTargetResize(){this._updateHandlers()}_createHandlers(){for(let t=0;t<8;t+=1){const{className:e,direction:i}=$[t],s=N.createHandler({classNames:"handler-resize-"+e,dataset:{direction:i}});s.setAttribute("cx",0),s.setAttribute("cy",0),this._target._addControl(s,{mousedown:this._onGrab,mouseup:this.endDrag}),this._handlers[t]=s}this._updateHandlers()}attach(){const{_target:t}=this,e=t.getCanvas();this._createHandlers(),e.addListener(H.RESIZE,t,this._onTargetResize),e.addListener(H.SIZE_CHANGE,t,this._onTargetResize)}}var Z=K;var J=class extends L{constructor(t,{width:e,height:i},s=null){super(t);let{x:n,y:r}=t.getPosition();const o=t.getSize(),a=(e-o.width)/2,h=(i-o.height)/2;switch(s){case U:case j:case V:n+=a;break;case W:case G:case F:n-=a}switch(s){case k:case G:case j:r-=h;break;case X:case F:case V:r+=h}this._before={position:t.getPosition(),size:o},this._after={position:{x:n,y:r},size:{width:e,height:i}}}execute(){this._receiver.setPosition(this._after.position),this._receiver.setSize(this._after.size)}undo(){this._receiver.setPosition(this._before.position),this._receiver.setSize(this._before.size)}};var q=class extends L{constructor(t){super(t),this._before={canvas:t.getCanvas(),connections:t.getConnectedShapes()}}execute(){this._receiver.remove()}undo(){const{canvas:t,connections:e}=this._before;t.addShape(this._receiver),e.forEach(([e,i])=>{i===Pt.ORIG?t.connect(e,this._receiver):t.connect(this._receiver,e)})}};var Q=class extends L{constructor(t,e){super(t),this._after={shape:e}}execute(){this._receiver.addShape(this._after.shape)}undo(){this._after.shape.remove()}};var tt=class extends L{constructor(t){super(t),this._after={canvas:t.getCanvas(),orig:t.getOrigShape(),dest:t.getDestShape()}}execute(){this._receiver.remove()}undo(){const{canvas:t,orig:e,dest:i}=this._after;t.connect(e,i,this._receiver)}};var et=class extends L{constructor(t,e,i,s){super(t),this._before={origShape:s?s.getOrigShape():null,destShape:s?s.getDestShape():null},this._after={origShape:e,destShape:i},this._connection=s}execute(){const{origShape:t,destShape:e}=this._after;this._connection=this._receiver.connect(t,e,this._connection)}undo(){const{origShape:t,destShape:e}=this._before;t&&e?this._receiver.connect(t,e,this._connection):this._connection.remove()}};const it=Object.freeze({SHAPE_ADD:0,SHAPE_TEXT:1,SHAPE_POSITION:2,SHAPE_RESIZE:3,SHAPE_REMOVE:4,CONNECT:5,CONNECTION_REMOVE:6});var st=new _({products:{[it.SHAPE_ADD]:Q,[it.SHAPE_TEXT]:B,[it.SHAPE_POSITION]:O,[it.SHAPE_RESIZE]:J,[it.SHAPE_REMOVE]:q,[it.CONNECT]:et,[it.CONNECTION_REMOVE]:tt}});let nt=null;const rt=r.createSVG("foreignObject"),ot=document.createElementNS("http://www.w3.org/1999/xhtml","input");ot.type="text",rt.classList.add("diagramax"),rt.classList.add("shape-text-input"),rt.setAttribute("width",100),rt.setAttribute("height",30),rt.appendChild(ot);const at=()=>{try{rt.remove()}catch(t){}};ot.addEventListener("change",t=>{nt.getCanvas().executeCommand(it.SHAPE_TEXT,nt,t.target.value),at()},!1),ot.addEventListener("keydown",t=>{let e;if(void 0!==t.code?e=t.code:void 0!==t.keyCode&&(e=27===t.keyCode?"Escape":""),void 0!==e)switch(e){case"Escape":ot.value=nt.getText(),at()}},!1),ot.addEventListener("blur",at,!1);var ht=class extends v{constructor(t,e){super(t,e),this._onEnterEditAction=this._bind(this._onEnterEditAction)}_onEnterEditAction(t){const{_target:e}=this;t.stopPropagation(),nt=e,ot.value=e.getText(),e.getElement().appendChild(rt),ot.select()}end(){nt===this._target&&at()}attach(){this._target.getElement().addEventListener("dblclick",this._onEnterEditAction,!1)}detach(){this._target.getElement().removeEventListener("dblclick",this._onEnterEditAction,!1),super.detach()}};const ct=Object.freeze({DEFAULT:"default"});var dt=new _({products:{[ct.DEFAULT]:ht}});var _t=class extends I{constructor(t,e){t instanceof yt||o.invalidParameter(),super(t,e),this._diff={x:0,y:0},this._lastPosition=null,this._lastDragPosition=null,this.updatePosition=this._bind(this.updatePosition)}_onGrab(t){if(0!==t.button)return;const e=this._target.getCanvas();super._onGrab(t),e.setDraggingShape(this._target)}startDrag(t){this._dragging||(super.startDrag(t),this._target.getCanvas().dispatchEvent(ft.DRAG_START,this._target))}endDrag(t){if(this._grabbed||this._dragging){const{_target:e,_dragging:i}=this,s=e.getCanvas();if(super.endDrag(t),s.setDraggingShape(null),i){const t=R.getDiff(e.getPosition(),this._lastDragPosition);0!==t.x||0!==t.y?s.executeCommand(it.SHAPE_POSITION,e,this._lastDragPosition):e.setPosition(this._lastDragPosition),s.dispatchEvent(ft.DRAG_END,e)}this._lastPosition=null,this._lastDragPosition=null}}_evaluate(t,e){return{diffX:t,diffY:e}}updatePosition({x:t,y:e}){this._lastPosition||(this._lastPosition=this._target.getPosition()),this._diff.x+=t-this._lastPosition.x,this._diff.y+=e-this._lastPosition.y;if(this._evaluate(this._diff.x,this._diff.y)){const i=this._target,s=i.getCanvas(),{x:n,y:r}=this._lastDragPosition||i.getPosition(),o={x:n+this._diff.x,y:r+this._diff.y};this._lastPosition={x:t,y:e},this._diff.x=0,this._diff.y=0,i._updatePosition(o.x,o.y),this._lastDragPosition=o,s.dispatchEvent(ft.DRAG,this._target,o)}super.updatePosition({x:t,y:e})}attach(){const{_target:t}=this;t._getMainElement().addEventListener("mousedown",this._onGrab,!1),t._getMainElement().addEventListener("click",this._onRelease,!1),super.attach()}detach(){const{_target:t}=this;t._getMainElement().removeEventListener("mousedown",this._onGrab,!1),t._getMainElement().removeEventListener("click",this._onRelease,!1)}};const lt=Object.freeze({DEFAULT:"default"});var ut=new _({products:{[lt.DEFAULT]:_t}});var gt=class extends v{constructor(t,e){t instanceof yt||o.invalidParameter(),super(t,e),this._onMouseDown=this._bind(this._onMouseDown),this._onMouseUp=this._bind(this._onMouseUp),this._onConnectionEnter=this._bind(this._onConnectionEnter),this._onConnectionLeave=this._bind(this._onConnectionLeave),this.end=this.end.bind(this)}_canAcceptCurrentConnection(){const{_target:t}=this,e=t.getCanvas()._connectivityAreaBehavior.getCurrentProcess();let i=!0;if(e){const[s,,n]=e;i=t.canAcceptConnection(n,s)}return i}_onMouseDown(t){if(0!==t.button)return;const e=this._target;t.stopPropagation(),!e.isBeingDragged()&&t.altKey&&e.getCanvas().startConnection(e)}_onMouseUp(t){const e=this._target;if(t.stopPropagation(),!e.isBeingDragged()){const t=e.getCanvas();this._canAcceptCurrentConnection()?t.completeConnection(e):(t.cancelConnection(),e.getElement().classList.remove("cant-connect"))}}_onConnectionEnter(){const{_target:t}=this,e=t.getCanvas();this._canAcceptCurrentConnection()?e._connectivityAreaBehavior.enterShape(t):t.getElement().classList.add("cant-connect")}_onConnectionLeave(){const{_target:t}=this;t.getCanvas()._connectivityAreaBehavior.leaveShape(t),t.getElement().classList.remove("cant-connect")}end(){this._target.getCanvas().getConnectivityAreaBehavior().end()}attach(){const{_target:t}=this,e=t.getElement(),i=t.getCanvas();e.addEventListener("mousedown",this._onMouseDown,!1),e.addEventListener("mouseup",this._onMouseUp,!1),e.addEventListener("mouseenter",this._onConnectionEnter,!1),e.addEventListener("mouseleave",this._onConnectionLeave,!1),i.addListener(ft.DRAG_START,t,this.end)}detach(){const{_target:t}=this,e=t.getElement(),i=t.getCanvas();e.removeEventListener("mousedown",this._onMouseDown,!1),e.removeEventListener("mouseup",this._onMouseUp,!1),e.removeEventListener("mouseenter",this._onConnectionEnter,!1),e.removeEventListener("mouseleave",this._onConnectionLeave,!1),i.removeListener(ft.DRAG_START,t,this.end),super.detach()}};const pt=Object.freeze({DEFAULT:"default"});var vt=new _({products:{[pt.DEFAULT]:gt}});const mt=Object.freeze({DEFAULT:"default"});var Et=new _({products:{[mt.DEFAULT]:Z}});const St={x:0,y:0,resizeBehavior:mt.DEFAULT,connectivityBehavior:pt.DEFAULT,dragBehavior:lt.DEFAULT,textEditBehavior:ct.DEFAULT},ft=Object.freeze({DRAG_START:"drag:start",DRAG:"drag",DRAG_END:"drag:end",POSITION_CHANGE:"position:change",SHAPE_CONNECT:"shape:connect",SHAPE_DISCONNECT:"shape:disconnect"});class xt extends w{static get type(){return"shape"}constructor(t){super(t),t={...St,...t},this._x=null,this._y=null,this._cx=null,this._cy=null,this._cWidth=null,this._cHeight=null,this._connections=new Set,this._ports=[],this._editableBehavior=dt.create(t.textEditBehavior,this),this._dragBehavior=ut.create(t.dragBehavior,this),this._connectivityBehavior=vt.create(t.connectivityBehavior,this),this._resizeBehavior=Et.create(t.resizeBehavior,this),this._initPorts().setPosition(t.x,t.y)}_setCanvas(t){return this._canvas!==t&&(super._setCanvas(t),t.addShape(this)),this}_getComponentUI(){return new N(this)}_initPorts(){return Object.values(At).forEach(t=>{"number"==typeof t&&(this._ports[t]=new wt({shape:this,position:t}))}),this}_updatePosition(t,e){this._cx=t,this._cy=e,this._el&&(this._el.setAttribute("transform",`translate(${t}, ${e})`),this._drawConnections())}setX(t){this.setPosition(t,this._y)}getX(){return this._x}setY(t){this.setPosition(this._x,t)}getY(){return this._y}getCurrentPosition(){return{x:this._cx,y:this._cy}}setPosition(...t){const e=this.getCanvas(),i=this.getPosition();let[s,n]=t;1===t.length&&(s=t[0].x,n=t[0].y),this._x=s,this._y=n,this._updatePosition(s,n),!e||i.x===s&&i.y===n||e.dispatchEvent(ft.POSITION_CHANGE,this,this.getPosition(),i)}getPosition(){return{x:this._x,y:this._y}}_updateSize(t,e){return this._cWidth=t,this._cHeight=e,this._drawConnections()}_updateWidth(t){const{height:e}=this.getCurrentSize();this._updateSize(t,e)}_updateHeight(t){const{width:e}=this.getCurrentSize();this._updateSize(e,t)}setWidth(t,e=!1){o.notImplemented()}getWidth(){return this.getSize().width}setHeight(t,e=!1){o.notImplemented()}getHeight(){return this.getSize().height}getRatio(){return this.getWidth()/this.getHeight()}_mapSize(t,e){this._width=t,this._height=e}setSize(...t){const e=this.getSize();let[i,s]=t;1===t.length&&(i=t[0].width,s=t[0].height),this._mapSize(i,s),this._updateSize(i,s);const n=this.getCanvas();!n||i===e.width&&s===e.height||n.dispatchEvent(H.SIZE_CHANGE,this,{previous:e,current:{width:i,height:s},position:this.getPosition()})}getCurrentSize(){return{width:this._cWidth,height:this._cHeight}}getBounds(){o.notImplemented()}getSize(){const{top:t,right:e,bottom:i,left:s}=this.getBounds();return{width:e-s,height:i-t}}canAcceptConnection(t,e=null){return!0}getPortPoint(t){const{x:e,y:i}=this.getCurrentPosition(),{orientation:s,direction:n}=Tt(t),{width:r,height:o}=this.getCurrentSize();return{x:e+(s===bt.X?r/2:0)*n,y:i+(s===bt.Y?o/2:0)*n}}getPort(t){return this._ports[t]}addOutgoingConnection(t){t instanceof ee||o.invalidParameter();const e=t.getDestShape();let i=!1;return this.canAcceptConnection(Pt.ORIG,e)&&(i=t.getOrigShape()===this||t.connect(this,e),i&&(this._connections.add(t),this.getCanvas().dispatchEvent(ft.SHAPE_CONNECT,this,{otherShape:e,connection:t,mode:Pt.DEST}))),i}getOutgoingConnections(){return new Set([...this._connections].filter(t=>t.getOrigShape()===this))}addIncomingConnection(t){t instanceof ee||o.invalidParameter();const e=t.getOrigShape();let i=!1;return this.canAcceptConnection(Pt.DEST,e)&&(i=t.getDestShape()===this||t.connect(e,this),i&&(this._connections.add(t),this.getCanvas().dispatchEvent(ft.SHAPE_CONNECT,this,{otherShape:e,connection:t,mode:Pt.ORIG}))),i}getIncomingConnections(){return new Set([...this._connections].filter(t=>t.getDestShape()===this))}getConnectedShapes(){const t=new Set;return this._connections.forEach(e=>{const i=e.getOrigShape(),s=this===i,n=s?e.getDestShape():i;t.add([n,s?Pt.DEST:Pt.ORIG])}),t}_removeFromPorts(t,e=null){let i=!1;return this._ports.forEach(s=>{s.hasConnection(t)&&(null===e||s.mode===e?s.removeConnection(t):i=!0)}),!i}removeConnection(t,e=null){if(this._connections.has(t)){const i=t.getDestShape(),s=i===this?t.getOrigShape():i;this._removeFromPorts(t,e)&&(this._connections.delete(t),t.isConnectedWith(this)&&t.disconnect(),this.getCanvas().dispatchEvent(ft.SHAPE_DISCONNECT,this,{connection:t,otherShape:s,mode:e}))}return this}removeConnections(){return this._connections.forEach(t=>{this.removeConnection(t)}),this}assignConnectionToPort(t,e,i){return this._removeFromPorts(t,i),this._ports[e].addConnection(t,i),this}isUsingConnection(t){return this._connections.has(t)}isBeingDragged(){return this._dragBehavior.isDragging()}isBeingResized(){return this._resizeBehavior.isDragging()}remove(){const{_canvas:t}=this;return t&&(this.removeConnections(),super.remove()),this}hasAvailablePortFor(t,e){const i=this._ports[t];if(i){if(null===i.mode){return this._ports.filter(t=>t.mode===e).length<3}return i.isAvailableFor(e)}return!1}align(t,e=null){const{width:i,height:s}=this.getCurrentSize();let{x:n,y:r}=R.getBoundSizeAndPos(t);switch(e){case W:case G:case F:n=t.left+i/2;break;case U:case j:case V:n=t.right-i/2}switch(e){case k:case G:case j:r=t.top+s/2;break;case X:case F:case V:r=t.bottom-s/2}this._updatePosition(n,r)}getConnectionPort(t,e){const i=t instanceof xt,s=i?t.getPosition():t.point,n=this.getBounds(),r=this.getCurrentPosition();let o,a=R.getNormalizedPosition(e===Pt.ORIG?r:s,e===Pt.ORIG?s:r),h=!1,c=!1;if(i){const e=R.getOverlappedDimensions(n,t.getBounds());h=e.x,c=e.y}else R.isInBetween(t.point.x,n.left,n.right)&&(h=!0),R.isInBetween(t.point.y,n.top,n.bottom)&&(c=!0);h&&c?o=e===Pt.ORIG?bt.X:bt.Y:(e===Pt.DEST&&(a={x:-1*a.x,y:-1*a.y}),o=h===c?e===Pt.ORIG?bt.Y:bt.X:0===a.x?bt.Y:0===a.y?bt.X:h?bt.Y:bt.X);const d=function(t,{x:e,y:i}){const s=t===bt.X?bt.Y:bt.X,n=wt.getPriority(t,t===bt.X?e:i),r=wt.getPriority(s,s===bt.X?e:i);return n.splice(1,0,...r),n}(o,a).find(t=>this.hasAvailablePortFor(t,e));return null!==d?this.getPort(d):null}_resetPorts(){return this._ports.forEach(t=>{t.clearConnections()}),this}_drawConnections(){return this._resetPorts(),this._connections.forEach(t=>{t.make()}),this}toJSON(){return{...super.toJSON(),x:this._x,y:this._y,width:this.getWidth(),height:this.getHeight()}}_createElement(){return this._el||(super._createElement(),this._el.classList.add("shape"),this._el.setAttribute("transform",`translate(${this._x}, ${this._y})`),this._connectivityBehavior.attach(),this._dragBehavior.attach(),this._resizeBehavior.attach(),this._editableBehavior.attach()),this}}var yt=xt;const Ct={connections:[],shape:null},bt=Object.freeze({X:"x",Y:"y"}),Dt=Object.freeze({NEGATIVE:-1,POSITIVE:1}),Pt=Object.freeze({ORIG:0,DEST:1}),At=Object.freeze({NORTH:0,EAST:1,SOUTH:2,WEST:3,props:{0:{orientation:bt.Y,direction:Dt.NEGATIVE},1:{orientation:bt.X,direction:Dt.POSITIVE},2:{orientation:bt.Y,direction:Dt.POSITIVE},3:{orientation:bt.X,direction:Dt.NEGATIVE}}});function Tt(t){return At.props[t]}var wt=class{static getPriority(t,e){let i;switch(t){case bt.Y:i=e===Dt.NEGATIVE?[At.NORTH,At.SOUTH]:[At.SOUTH,At.NORTH];break;case bt.X:default:i=e===Dt.NEGATIVE?[At.WEST,At.EAST]:[At.EAST,At.WEST]}return i}constructor(t){this._mode=null,this._position=null,this._connections=new Set,this._shape=null,t={...Ct,...t},this._setShape(t.shape)._setPosition(t.position).setConnections(t.connections)}get mode(){return this._mode}get orientation(){return Tt(this._position).orientation}get direction(){return Tt(this._position).direction}get size(){return this._connections.size}_setShape(t){return t instanceof yt||o.invalidParameter(),this._shape=t,this}_setPosition(t){return this._position=t,this}isAvailableFor(t){return null===this._mode||this._mode===t}addConnection(t,e){return t instanceof ee?this._shape.isUsingConnection(t)?(e===Pt.DEST&&t.getDestShape()!==this._shape||e===Pt.ORIG&&t.getOrigShape()!==this._shape)&&o.custom("Mode doesn't match with connection direction."):o.custom("The supplied connection doesn't belong to this shape."):o.invalidParameter(),e!==this._mode&&null!==this._mode&&o.custom("Invalid connection direction."),this._mode=e,this._connections.add(t),this}setConnections(t){return t.forEach((t,e)=>{this.addConnection(t,e)}),this}hasConnection(t){return this._connections.has(t)}removeConnection(t){return this._connections.delete(t)&&(this._mode=this._connections.size?this._mode:null),this}clearConnections(){return this._connections.clear(),this._mode=null,this}getDescription(){const t=this._position;return{orientation:this.orientation,direction:this.direction,mode:this.mode,point:this._shape.getPortPoint(t),portIndex:t}}};function Lt(t){return t[0].x===t[1].x?bt.Y:t[0].y===t[1].y?bt.X:void o.custom("Diagonal segment?")}function Ot(t){const e=[Math.min(t[0].x,t[1].x),Math.max(t[0].x,t[1].x)],i=[Math.min(t[0].y,t[1].y),Math.max(t[0].y,t[1].y)];return[{x:e[0],y:i[0]},{x:e[1],y:i[1]}]}var Bt={getIntersectionPoints(t){const e=t.getBounds(),i=t.getCanvas(),s=i&&i.getConnections()||[],n=[];return s.forEach(i=>{const s=i.getOrigShape(),r=i.getDestShape();let o;if(!(s&&s.isBeingDragged()||r&&r.isBeingDragged())&&i!==t&&(o=i.getBounds(),R.areOverlapped(e,o))){(function(t,e){if(t!==e){const i=t.getSegments(),s=e.getSegments(),n=[];return i.forEach((i,r)=>{const o=Lt(i),a=[];i=Ot(i),s.forEach((s,n)=>{const r=Lt(s);if(s=Ot(s),o!==r){let r;o===bt.X&&i[0].y>s[0].y&&i[0].y<s[1].y&&s[0].x>i[0].x&&s[0].x<i[1].x?r={x:s[0].x,y:i[0].y}:o===bt.Y&&i[0].x>s[0].x&&i[0].x<s[1].x&&s[0].y>i[0].y&&s[0].y<i[1].y&&(r={x:i[0].x,y:s[0].y}),r&&(e.hasIntersectionPoint(r.x,r.y)?e.addIntersection(n,t,r):a.push(r))}}),n[r]=a}),n}return[]})(t,i).forEach((t,e)=>{if(t){const s=t.map(t=>({connection:i,point:t}));n[e]=n[e]||[],n[e].push(...s)}})}}),n}};var It=class extends d{get(t){return this._products[t]||o.custom(`Strategy '${t}' is not registered.`),this._products[t]}};function Rt(t,e){const{x:i,y:s}=t.point,{orientation:n}=t;return{x:i+(n===bt.X?e:0),y:s+(n===bt.Y?e:0)}}var zt=function t(e,i){const s=R.getNormalizedPosition(e.point,i.point);let n,r;if(e.direction!==s[e.orientation]?(n=e,r=1):i.direction!==-1*s[i.orientation]&&(n=i,r=-1),n){const o=function(t,e,i){const{direction:s}=t;return{point:Rt(t,ee.ARROW_SEGMENT_LENGTH*s),orientation:t.orientation===bt.X?bt.Y:bt.X,direction:(t.orientation===bt.X?e.y:e.x)*i||1}}(n,s,r),{point:a}=o;return n===e?[e.point,a].concat(t(o,i)):t(e,o).concat(a,i.point)}if(e.orientation!==i.orientation)return[e.point,{x:e.orientation===bt.X?i.point.x:e.point.x,y:i.orientation===bt.X?i.point.y:e.point.y},i.point];if(e.point.x===i.point.x||e.point.y===i.point.y)return[e.point,i.point];const o=(i.point[e.orientation]-e.point[e.orientation])/2;return[e.point,Rt(e,o),Rt(i,-1*o),i.point]};const Mt=Object.freeze({RECT:0});var Nt=new It({products:{[Mt.RECT]:zt}});var Ht=function(t,e){return`L${e.x} ${e.y}`};const Gt=Object.freeze({STRAIGHT:0});var kt=new It({products:{[Gt.STRAIGHT]:Ht}});var jt=function(t,e,i){return`L${e.x} ${e.y}`};var Ut=function(t,e,i){return`Q ${e.x} ${e.y} ${i.x} ${i.y}`};const Vt=Object.freeze({RECT:0,ARC:1});var Xt=new It({products:{[Vt.RECT]:jt,[Vt.ARC]:Ut}});var Ft=function(t,{from:e,to:i},s){const n=R.getPathLength(e,i),r=ee._getSegmentOrientation(e,i),o=ee._getSegmentDirection(e,i);let a=!1,h=t,c=10;if(n<c)if(s){c=R.getPathLength(s.start,s.end)+n,h=R.getMiddlePoint(s.start,i),a=!0}else c=n,h=R.getMiddlePoint(e,i);else if(R.getPathLength(e,t)<5)if(s){const e=R.movePoint(t,5*o,r);c=R.getPathLength(s.start,e),h=R.getMiddlePoint(s.start,e),a=!0}else h=R.movePoint(e,5*o,r);else R.getPathLength(i,t)<5&&(h=R.movePoint(i,5*o*-1,r));if(c){const t=c*o,e=t/2;let{x:i,y:s}=h,{x:n,y:d}=h,_=0,l=0;return r===bt.X?(i-=e,n+=e,l=t):(s-=e,d+=e,_=t),{start:{x:i,y:s},end:{x:n,y:d},data:`c${_} ${l}, ${t} ${t}, ${l} ${_}`,replace:a}}return null};const Wt=Object.freeze({ARC:0});var Yt=new It({products:{[Wt.ARC]:Ft}});var $t=class extends I{constructor(t,e){super(t,e),this._dom={},this._shape=null,this._otherShape=null,this._onPortChange=this._onPortChange.bind(this)}startDrag(t,e){super.startDrag(),this._dom.origHandler.setAttribute("pointer-events","none"),this._dom.destHandler.setAttribute("pointer-events","none"),this._target.getElement().setAttribute("pointer-events","none")}start(t,e){this._shape=t,this._target.getCanvas().setDraggingConnection(this._target,e)}_onGrab(t){if(0!==t.button)return;const{_target:e}=this,i=Number(t.target.dataset.point);super._onGrab(t),e.getCanvas().startReconnection(e,i)}end(){const{_target:t}=this;(this._shape||this._otherShape)&&(super.endDrag(),this._shape=null,this._otherShape=null,this._dom.origHandler.removeAttribute("pointer-events"),this._dom.destHandler.removeAttribute("pointer-events"),this._target.getElement().removeAttribute("pointer-events"),this._target.getCanvas().setDraggingConnection(null),t.getOrigShape()&&t.getDestShape()?t.make():t.remove())}endDrag(){this.end()}updatePosition(t,{draggingPoint:e},i){const s=this._shape,n=e===Pt.ORIG,r=n?Pt.DEST:Pt.ORIG,o=this._otherShape?this._otherShape.getConnectionPort(s,e).getDescription():function(t,e){const i=R.getNormalizedPosition(t,e.getPosition()),s=e.getBounds();let n,r=bt.X;return R.isInBetween(t.x,s.left,s.right)&&(r=bt.Y),n=r===bt.Y?i.y:i.x,{direction:n,orientation:r,point:t,mode:Pt.DEST}}(t,s),a=s.getConnectionPort(o,r).getDescription();n?(this._updateHandlers(o,a),this._target._draw(o,a)):(this._updateHandlers(a,o),this._target._draw(a,o))}onShape(t){this._otherShape=t}outShape(t){this._otherShape=null}_getControlsListeners(){return{mousedown:this._onGrab,mouseup:this._onRelease}}_createHandlers(){const{_target:t}=this;if(!this._dom.origHandler){const e="connection-handler";this._dom.origHandler=N.createHandler(),this._dom.destHandler=N.createHandler(),this._dom.origHandler.classList.add(e),this._dom.destHandler.classList.add(e),this._dom.origHandler.dataset.point=Pt.ORIG,this._dom.destHandler.dataset.point=Pt.DEST,t._addControl(this._dom.origHandler,this._getControlsListeners()),t._addControl(this._dom.destHandler,this._getControlsListeners())}}_updateHandlers({point:t},{point:e}){[t,e].includes(null)||(this._dom.origHandler.setAttribute("cx",t.x),this._dom.origHandler.setAttribute("cy",t.y),this._dom.destHandler.setAttribute("cx",e.x),this._dom.destHandler.setAttribute("cy",e.y))}_onPortChange(t,{origPort:e,destPort:i}){e&&i&&this._updateHandlers(e.getDescription(),i.getDescription())}_getDraggableElement(){return[this._dom.origHandler,this._dom.destHandler]}attach(){const{_target:t}=this;t.getCanvas().addListener(Jt.PORT_CHANGE,t,this._onPortChange,this),this._createHandlers(),super.attach()}detach(){const{_target:t}=this;t.getCanvas().removeListener(Jt.PORT_CHANGE,t,this._onPortChange,this),super.detach()}};const Kt=Object.freeze({DEFAULT:"default"});var Zt=new _({products:{[Kt.DEFAULT]:$t}});const Jt=Object.freeze({CONNECT:"connect",PORT_CHANGE:"portchange",DISCONNECT:"disconnect"}),qt={waypoint:Mt.RECT,line:Gt.STRAIGHT,vertex:Vt.ARC,vertexSize:10,intersection:Wt.ARC,dragBehavior:Kt.DEFAULT},Qt=Object.freeze({WIDTH:10,HEIGHT:8});class te extends w{static get type(){return"connection"}static get ARROW_SEGMENT_LENGTH(){return 20}static get INTERSECTION_SIZE(){return Qt}static _getSegmentOrientation(t,e){let i;return i=t.x===e.x?bt.Y:t.y===e.y?bt.X:-1,-1===i&&o.custom("Diagonal segment?"),i}static _getSegmentDirection(t,e){return t.x<e.x||t.y<e.y?1:t.x>e.x||t.y>e.y?-1:0}constructor(t){super(t),t={...qt,...t},this._points=[],this._origShape=null,this._destShape=null,this._origPort=null,this._destPort=null,this._interceptors=new Set,this._intersections=new Map,this._dragBehavior=Zt.create(t.dragBehavior,this),this._waypointStrategy=Nt.get(t.waypoint),this._lineStrategy=kt.get(t.line),this._vertexStrategy=Xt.get(t.vertex),this._vertexSize=t.vertexSize,this._intersectionStrategy=Yt.get(t.intersection)}_getComponentUI(){return new z(this)}addInterceptor(t){this._interceptors.add(t)}_setCanvas(...t){return this._intersections?super._setCanvas(...t):this}addIntersection(t,e,i){let s=this._intersections.get(t);s||(s=[],this._intersections.set(t,s)),s.push({connection:e,point:i})}hasIntersectionPoint(t,e){const i=this._intersections.entries();let s=i.next();for(;!s.done;){const[,n]=s.value;if(n.find(({point:i})=>t===i.x&&e===i.y))return!0;s=i.next()}return!1}_updateIntersectionPoints(){const t=Bt.getIntersectionPoints(this);this._removeIntersections(),t.forEach((t,e)=>{t&&(t.forEach(t=>{t.connection.addInterceptor(this)}),this._intersections.set(e,t))})}_removeInterceptors(){this._interceptors.forEach(t=>t._removeIntersections(this)),this._interceptors.clear()}_removeIntersections(t=null){t&&this._origPort&&this._destPort?(this._intersections.forEach((e,i)=>{this._intersections.set(i,e.filter(e=>e.connection!==t))}),this._draw(this._origPort.getDescription(),this._destPort.getDescription())):this._intersections.clear()}_onShapeDragStart(){this._el.setAttribute("opacity",.3),this._removeInterceptors(),this._removeIntersections()}_onShapeDrag(){this.make()}_onShapeDragEnd(){this._el.setAttribute("opacity",1),this.make()}_onShapePositionChange(){this.make()}_addDragListeners(t){return this._canvas.addListener(ft.DRAG_START,t,this._onShapeDragStart,this),this._canvas.addListener(ft.DRAG_END,t,this._onShapeDragEnd,this),this._canvas.addListener(H.START,t,this._onShapeDragStart,this),this._canvas.addListener(H.END,t,this._onShapeDragEnd,this),this}_removeDragListeners(t){const{_canvas:e}=this;return e&&(this._canvas.removeListener(ft.DRAG_START,t,this._onShapeDragStart,this),this._canvas.removeListener(ft.DRAG_END,t,this._onShapeDragEnd,this),this._canvas.removeListener(H.START,t,this._onShapeDragStart,this),this._canvas.removeListener(H.END,t,this._onShapeDragEnd,this)),this}getOrigShape(){return this._origShape}getDestShape(){return this._destShape}getOrigPort(){return this._origPort}getDestPort(){return this._destPort}start(t,e){this._dragBehavior.start(t,e)}end(){this._dragBehavior.end()}connect(t,e){const i=t.getCanvas(),s=e.getCanvas();if(i===s&&t.canAcceptConnection(Pt.ORIG,e)&&e.canAcceptConnection(Pt.DEST,t)&&!t._connectivityBehavior._disabled&&!e._connectivityBehavior._disabled){const{_origShape:n,_destShape:r}=this,o=t!==n,a=e!==r;let h=!0;return this._origShape=t,this._destShape=e,o&&(n&&(n.removeConnection(this,Pt.ORIG),this._removeDragListeners(n),this._points=[]),h=t.addOutgoingConnection(this),h&&(this._setCanvas(i),this._addDragListeners(t))),a&&h&&(r&&(r.removeConnection(this,Pt.DEST),this._removeDragListeners(r),this._points=[]),h=e.addIncomingConnection(this),h&&(this._setCanvas(s),this._addDragListeners(e))),h?((o||a)&&this._canvas.dispatchEvent(Jt.CONNECT,this,{origShape:t,destShape:e}),this.make()):this.disconnect(),h}return!1}isConnected(){return this._origShape&&this._destShape}getBounds(){return this._points.reduce((t,{x:e,y:i})=>t?(t.top=Math.min(i,t.top),t.right=Math.max(e,t.right),t.bottom=Math.max(i,t.bottom),t.left=Math.min(e,t.left),t):{top:i,right:e,bottom:i,left:e},null)||{}}getSegments(){const t=[];for(let e=1;e<this._points.length;e+=1)t.push([{x:this._points[e-1].x,y:this._points[e-1].y},{x:this._points[e].x,y:this._points[e].y}]);return t}disconnect(){return this.remove()}isConnectedWith(t){return this._origShape===t||this._destShape===t}_getVertexData(t,e,i){if(!(t&&e&&i))return null;const s=te._getSegmentDirection(t,e),n=te._getSegmentOrientation(t,e),r=R.getPathLength(t,e),o=te._getSegmentDirection(e,i),a=te._getSegmentOrientation(e,i),h=R.getPathLength(e,i)/2,c=Math.min(this._vertexSize,r,h),d=R.movePoint(e,c*s*-1,n),_=R.movePoint(e,c*o,a),l={x:n===bt.X?d.x:e.x,y:n===bt.Y?d.y:e.y},u={x:a===bt.X?_.x:e.x,y:a===bt.Y?_.y:e.y};return{data:this._vertexStrategy(l,e,u),start:l,middle:e,end:u}}_getSegmentData(t,e,i){const s=te._getSegmentOrientation(t,e),n=te._getSegmentDirection(t,e),r=e;let o,a=t;return s===bt.X?i.sort(({point:t},{point:e})=>(t.x<e.x?-1:1)*n):i.sort(({point:t},{point:e})=>(t.y<e.y?-1:1)*n),i.map(({point:t})=>{let e;const i=[];return R.isInLine(t,a,r)&&(e=this._intersectionStrategy(t,{from:a,to:r},o)),e&&(!e.replace&&o&&i.push(o.data),i.push(this._lineStrategy(a,e.start)),a=e.end),o=e,i.join(" ")}).concat(o&&o.data||"").concat(this._lineStrategy(a,r)).join(" ")}_draw(t,e){let i,s=[];t&&(s=this._waypointStrategy(t,e)),this._points=s,this._origShape&&this._destShape&&(this._origShape.isBeingDragged()||this._destShape.isBeingDragged()||this._origShape.isBeingResized()||this._destShape.isBeingResized()||this._updateIntersectionPoints());const n=s.map((t,e,s)=>{if(0===e)return`M${t.x} ${t.y}`;const n=s[e+1],r=[],o=i&&i.end||s[e-1],a=(this._intersections.get(e-1)||[]).slice(0);return n?(i=this._getVertexData(o,t,n),i?(r.push(this._getSegmentData(o,i.start,a)),r.push(i.data)):r.push(this._getSegmentData(o,t,a)),r.join(" ")):this._getSegmentData(o,t,a)}).join(" ");if(n){const t=s.length,e=te._getSegmentOrientation(s[t-2],s[t-1]),i=te._getSegmentDirection(s[t-2],s[t-1]),n=e===bt.X?2+i:1+-1*i;this._dom.arrow.setAttribute("transform",`translate(${s[s.length-1].x}, ${s[s.length-1].y})`),this._dom.arrowRotateContainer.setAttribute("transform",`scale(0.5, 0.5) rotate(${90*n})`)}return this._dom.mainElement.style.display=n?"":"none",this._dom.path.setAttribute("d",n),this}_setPorts(t,e){const{_origPort:i,_destPort:s}=this;let n=!1;if((t!==i||e!==s)&&(this._origPort=t,this._destPort=e,n=!0),!n&&t&&e){const r=t.getDescription(),o=e.getDescription(),a=i.getDescription(),h=s.getDescription();R.areSamePoint(r.point,a.point)&&!R.areSamePoint(o.point,h.point)||(n=!0)}n&&this._canvas.dispatchEvent(Jt.PORT_CHANGE,this,{origPort:t,destPort:e,oldOrigPort:i,oldDestPort:s})}make(){if(!this._origShape||!this._destShape||!this._el)return;const t=this._origShape.getConnectionPort(this._destShape,Pt.ORIG),e=this._destShape.getConnectionPort(this._origShape,Pt.DEST),i=t.getDescription(),s=e.getDescription();this._origShape.assignConnectionToPort(this,i.portIndex,Pt.ORIG),this._destShape.assignConnectionToPort(this,s.portIndex,Pt.DEST),this._setPorts(t,e),this._draw(i,s)}remove(){const t=this._origShape,e=this._destShape;return this._canvas&&(t&&t.getOutgoingConnections().has(this)&&(this._removeDragListeners(t),t.removeConnection(this,Pt.ORIG)),e&&e.getIncomingConnections().has(this)&&(this._removeDragListeners(e),e.removeConnection(this,Pt.DEST)),this._origShape=null,this._destShape=null,t&&e&&this._canvas&&(this._setPorts(null,null),this._removeInterceptors(),this._canvas.dispatchEvent(Jt.DISCONNECT,this,{origShape:t,destShape:e}),super.remove())),this}toJSON(){return{...super.toJSON(),orig:this._origShape.getID(),dest:this._destShape.getID()}}_createElement(){if(this._el)return this;super._createElement();const t=this._getMainElement(),e=r.createSVG("g"),i=r.createSVG("g"),s=r.createSVG("path"),n=r.createSVG("path");return i.setAttribute("transform","scale(0.5,0.5) rotate(-180)"),s.setAttribute("end","target"),s.setAttribute("d","M 0 0 L -13 -26 L 13 -26 z"),s.classList.add("arrow"),n.classList.add("path"),i.appendChild(s),e.appendChild(i),t.appendChild(e),t.appendChild(n),this._el.classList.add("connection"),this._dom.path=n,this._dom.arrow=e,this._dom.arrowRotateContainer=i,this._selectBehavior.attach(),this._dragBehavior.attach(),this.make(),this}}var ee=te;var ie=class extends v{constructor(t,e){super(t,e),this._dom={},this._connection=null,this._shape=null,this.start=this._bind(this.start),this.complete=this._bind(this.complete),this.enterShape=this._bind(this.enterShape),this.leaveShape=this._bind(this.leaveShape),this.end=this._bind(this.end)}end(){this._connection&&this._connection.end(),this._shape=null,this._connection=null,this._direction=null}start(t,e=null,i=Pt.DEST){this._shape||(this.complete(),e=e||new ee({canvas:this._target}),this._target._addConnection(e),this._connection=e,this._shape=t,this._direction=i,e.select(),e.start(t,i))}complete(t){if(this._shape&&t){const e=this._connection.getOrigShape(),i=this._connection.getDestShape();let s,n;this._direction===Pt.ORIG?(s=t,n=this._shape):(s=this._shape,n=t),e===s&&i===n||this._target.executeCommand(it.CONNECT,this._target,s,n,this._connection)}this.end()}enterShape(t){this._connection&&this._connection._dragBehavior.onShape(t)}leaveShape(t){this._connection&&this._connection._dragBehavior.outShape(t)}getCurrentProcess(){return this._connection?[this._shape,this._connection,this._direction]:null}connect(t,e){this._target.connect(t,e)}attach(){const{_target:t}=this;t.getElement().addEventListener("click",this.end,!1)}detach(){const{_target:t}=this;t.getElement().removeEventListener("click",this.end,!1),super.detach()}};const se=Object.freeze({DEFAULT:0});var ne=new _({products:{[se.DEFAULT]:ie}});var re=class extends v{constructor(t,e){super(t,e),this.removeDragBehavior(),this._onMouseMove=this._bind(this._onMouseMove),this._onClick=this._onClick.bind(this)}removeDragBehavior(){const t=this._dragBehavior;this._dragBehavior=null,this._behaviorOptions=null,this._started=!1,t&&t.endDrag()}setDragBehavior(t,e={}){t!==this._dragBehavior&&(this.removeDragBehavior(),this._dragBehavior=t,this._behaviorOptions={...e},t.getTarget().select())}_onMouseMove(t){if(this._dragBehavior){const{clientX:e,clientY:i}=t,{x:s,y:n}=this._target.clientToCanvas({x:e,y:i}),r=this.evaluate(s,n);if(this._started||(this._started=!0,this._dragBehavior.startDrag(r,this._behaviorOptions)),r){const e={altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey};this._dragBehavior.updatePosition(r,this._behaviorOptions,e)}}}_onClick(){this.removeDragBehavior()}end(){this.removeDragBehavior()}attach(){const{_target:t}=this;return t.getElement().addEventListener("mousemove",this._onMouseMove,!1),t.getElement().addEventListener("click",this._onClick,!1),this}detach(){const{_target:t}=this;t.getElement().removeEventListener("mousemove",this._onMouseMove,!1),t.getElement().removeEventListener("click",this._onClick,!1),super.detach()}evaluate(t,e){return{x:t,y:e}}};const oe=Object.freeze({DEFAULT:0});var ae=new _({products:{[oe.DEFAULT]:re}});Object.freeze({ADD:"selectionadd",REMOVE:"selectionremove",CLEAR:"selectionclear"});var he=class extends v{constructor(t,e){super(t,e),this._selection=new Set,this._add=this._bind(this._add),this.clear=this.clear.bind(this)}contains(t){return this._selection.has(t)}select(t){t._selectBehavior._select(this._add)}_add(t){return!this.contains(t)&&(this._selection.add(t),!0)}remove(t){return this.contains(t)&&(t.unselect(),this._selection.delete(t)),this}clear(){return this._selection.forEach(t=>{this.remove(t)}),this}end(){this.clear()}get(){return Array.from(this._selection)}attach(){this._target.getElement().addEventListener("mousedown",this.clear,!1)}detach(){this._target.getElement().removeEventListener("mousedown",this.clear,!1),super.detach()}};const ce=Object.freeze({DEFAULT:0});var de=new _({products:{[ce.DEFAULT]:he}});var _e=class extends v{constructor(t,e){super(t,e),this._onKeyDown=this._bind(this._onKeyDown)}_onKeyDown(t){const{_target:e}=this;switch(t.code){case"Delete":e.getSelection().forEach(t=>{let i,s;t instanceof yt?(i=e.findShape(t),s=it.SHAPE_REMOVE):t instanceof ee&&(i=e.findConnection(t),s=it.CONNECTION_REMOVE),i&&e.executeCommand(s,i)});break;case"Escape":e._draggingAreaBehavior.end(),e._connectivityAreaBehavior.end(),e._selectionBehavior.end()}}attach(){this._target.getElement().addEventListener("keydown",this._onKeyDown,!1),super.attach()}detach(){this._target.getElement().removeEventListener("keydown",this._onKeyDown,!1),super.detach()}};const le=Object.freeze({DEFAULT:0});var ue=new _({products:{[le.DEFAULT]:_e}});var ge=class{constructor(t){t={...t},this._size=t.size,this._stack=null,this._index=null,this.clear()}executeCommand(...t){let e=null;1===t.length?[e]=t:e=st.create(...t),this._stack=this._stack.slice(0,this._index+1),this._stack.push(e);const i=this.redo();return this._stack=this._stack.slice(-1*this._size,this._index+1),this._index=Math.min(this._index,this._size-1),i}getSteps(){return[this._index+1,this._stack.length-1-this._index]}undo(){const t=this._stack[this._index];let e=!1;return t&&!1!==t.undo()&&(this._index-=1,e=!0),e}redo(){const t=this._index+1,e=this._stack[t];let i=!1;return e&&!1!==e.execute()&&(this._index=t,i=!0),i}clear(){this._stack=[],this._index=-1}};function pe(){}const ve=Object.freeze({radius:30});var me=class extends yt{static get type(){return"circle"}constructor(t){super(t={...ve,...t}),this._radius=null,this.setRadius(t.radius)}_updateSize(t,e){const{circle:i}=this._dom,s=Math.min(t,e);i&&i.setAttribute("r",s/2),super._updateSize(s,s)}_updateWidth(t){this._updateSize(t,t)}_updateHeight(t){this._updateSize(t,t)}setRadius(t){const e=2*t;return this.setSize(e,e)}setWidth(t){return this.setSize(t,t)}setHeight(t){return this.setSize(t,t)}getRadius(){return this._radius}_mapSize(t,e){this._radius=Math.min(t,e)/2}getBounds(){const{_x:t,_y:e,_radius:i}=this;return{top:e-i,right:t+i,bottom:e+i,left:t-i}}_createElement(){if(!this._el){const t=r.createSVG("circle");super._createElement(),t.setAttribute("cx",0),t.setAttribute("cy",0),this._dom.circle=t,this._getMainElement().append(t),this.setRadius(this._radius)}return this}};const Ee={radiusX:50,radiusY:40};var Se=class extends yt{static get type(){return"ellipse"}constructor(t){super(t={...Ee,...t}),this._radiusX=null,this._radiusY=null,this.setSize(t.radiusX,t.radiusY)}_updateSize(t,e){const{ellipse:i}=this._dom;this._cWidth=t,this._cHeight=e,i&&(i.setAttribute("rx",this._cWidth/2),i.setAttribute("ry",this._cHeight/2))}setRadiusX(t){const e=this.getHeight();return this.setSize(2*t,e)}getRadiusX(){return this._radiusX}setWidth(t){return this.setRadiusX(t/2)}setRadiusY(t){const e=this.getWidth();return this.setSize(e,2*t)}getRadiusY(){return this._radiusY}setHeight(t){return this.setRadiusY(t/2)}_mapSize(t,e){this._radiusX=t/2,this._radiusY=e/2}getBounds(){const{_x:t,_y:e,_radiusX:i,_radiusY:s}=this;return{top:e-s,right:t+i,bottom:e+s,left:t-i}}_createElement(){if(!this._el){const t=r.createSVG("ellipse");super._createElement(),t.setAttribute("cx",0),t.setAttribute("cy",0),this._dom.ellipse=t,this._getMainElement().append(t),this.setSize(2*this._radiusX,2*this._radiusY)}return this}};class fe extends yt{static get type(){return"polygon"}static toPointsString(t){return t.map(({x:t,y:e})=>`${t},${e}`).join(" ")}_getPoints(){o.notImplemented()}_updateSize(t,e){const{polygon:i}=this._dom;return super._updateSize(t,e),i&&i.setAttribute("points",fe.toPointsString(this._getPoints())),this}_createElement(){if(!this._el){const t=r.createSVG("polygon");super._createElement(),this._dom.polygon=t,this._getMainElement().append(t),this.setSize(this._base,this._height)}return this}}var xe=fe;const ye=Object.freeze({base:80,height:80});var Ce=class extends xe{static get type(){return"triangle"}constructor(t){super(t={...ye,...t}),this._base=null,this._height=null,this.setSize(t.base,t.height)}setBase(t){const e=this.getHeight();return this.setSize(t,e)}getBase(){return this._base}setHeight(t){const e=this.getWidth();return this.setSize(e,t)}getHeight(){return this._height}setWidth(t){return this.setBase(t)}_mapSize(t,e){this._base=t,this._height=e}getPortPoint(t){const{x:e,y:i}=super.getPortPoint(t),{orientation:s,direction:n}=Tt(t);return{x:e-(s===bt.X?this.getWidth()/4:0)*n,y:i}}_getPoints(){const t=[this._cWidth/-2,0,this._cWidth/2],e=[this._cHeight/-2,this._cHeight/2];return[{x:t[0],y:e[1]},{x:t[1],y:e[0]},{x:t[2],y:e[1]}]}getBounds(){const{_x:t,_y:e}=this,i=this._base/2,s=this._height/2;return{top:e-s,right:t+i,bottom:e+s,left:t-i}}};const be={width:80,height:80};var De=class extends yt{static get type(){return"rectangle"}constructor(t){super(t={...be,...t}),this._width=null,this._height=null,this.setSize(t.width,t.height)}_updateSize(t,e){const{rect:i}=this._dom;super._updateSize(t,e),i&&(i.setAttribute("width",t),i.setAttribute("x",-.5*t),i.setAttribute("height",e),i.setAttribute("y",-.5*e))}setWidth(t){const e=this.getHeight();return this.setSize(t,e)}getWidth(){return this._width}setHeight(t){const e=this.getWidth();return this.setSize(e,t)}getHeight(){return this._height}getSize(){return{width:this._width,height:this._height}}_mapSize(t,e){this._width=t,this._height=e}getBounds(){const{_x:t,_y:e}=this,i=this._width/2,s=this._height/2;return{top:e-s,right:t+i,bottom:e+s,left:t-i}}_createElement(){if(!this._el){const t=r.createSVG("rect");super._createElement(),this._dom.rect=t,this._getMainElement().append(t),this.setSize(this._width,this._height)}return this}};const Pe=Object.freeze({CIRCLE:me.type,ELLIPSE:Se.type,TRIANGLE:Ce.type,RECTANGLE:De.type,CONNECTION:ee.type});var Ae=new _({products:{[Pe.CIRCLE]:me,[Pe.ELLIPSE]:Se,[Pe.TRIANGLE]:Ce,[Pe.RECTANGLE]:De,[Pe.CONNECTION]:ee}});const Te=Object.freeze({width:800,height:600,shapes:[],connections:[],stackSize:10,onChange:pe,onContextMenu:pe,onElementContextMenu:pe,selectionAreaBehavior:ce.DEFAULT,contextMenuBehavior:b.DEFAULT,draggingAreaBehavior:oe.DEFAULT,connectivityAreaBehavior:se.DEFAULT,keyboardControlBehavior:le.DEFAULT});var we=class extends r{static get type(){return"canvas"}constructor(t){super(t),t={...Te,...t},this._width=null,this._height=null,this._shapes=new Set,this._connections=new Set,this._dom={},this._eventBus=new h,this._selectedItems=new Set,this._onChange=t.onChange,this._onContextMenu=t.onContextMenu,this._onElementContextMenu=t.onElementContextMenu,this._selectionBehavior=de.create(t.selectionAreaBehavior,this),this._contextMenuBehavior=D.create(t.contextMenuBehavior,this),this._draggingAreaBehavior=ae.create(t.draggingAreaBehavior,this),this._connectivityAreaBehavior=ne.create(t.connectivityAreaBehavior,this),this._keyboardBehavior=ue.create(t.keyboardControlBehavior,this),this._commandManager=new ge({size:t.stackSize}),this.setWidth(t.width).setHeight(t.height).setShapes(t.shapes).setConnections(t.connections)}setWidth(t){return"number"!=typeof t&&o.invalidParameter(),this._width=t,this._el&&this._el.setAttribute("width",this._width),this}getWidth(){return this._width}setHeight(t){return"number"!=typeof t&&o.invalidParameter(),this._height=t,this._el&&this._el.setAttribute("height",this._height),this}getHeight(){return this._height}_onElementRemove(t){const e=t.target;this.hasElement(e)&&(this._shapes.delete(e)||this._connections.delete(e),this.removeListener(T.REMOVE,e,this._onElementRemove,this))}_drawElement(t){this._el&&(this._dom.componentsLayer.appendChild(t.getElement()),this._dom.uiLayer.appendChild(t.getUIHTML()))}addShape(t,...e){if(!(t instanceof yt)){let i,s;"string"==typeof t?(i=t,[s]=e):"object"==typeof t?(i=t.type,s=t):o.invalidParameter(),t=Ae.create(i,s)}return t instanceof yt&&!this._shapes.has(t)&&(this._shapes.add(t),t._setCanvas(this),this._drawElement(t),this.addListener(T.REMOVE,t,this._onElementRemove,this)),this}hasElement(t){return this._shapes.has(t)||this._connections.has(t)}clearShapes(){return this._shapes.forEach(t=>{t.remove()}),this}setShapes(t){return this.clearShapes(),t.forEach(t=>this.addShape(t)),this}clearConnections(){return this._connections.forEach(t=>{t.remove()}),this}setConnections(t){return this.clearConnections(),t.forEach(t=>{const{orig:e,dest:i}=t;this.connect(e,i,t)}),this}getConnections(){return[...this._connections]}findShape(t){return"string"==typeof t?[...this._shapes].find(e=>e.getID()===t)||null:(t instanceof yt||o.invalidParameter(),this._shapes.has(t)?t:null)}findConnection(t){return"string"==typeof t?[...this._connections].find(e=>e.getID()===t)||null:(t instanceof ee||o.invalidParameter(),this._connections.has(t)?t:null)}addListener(t,e,i=null,s=null){return this._eventBus.addListener.call(this._eventBus,t,e,i,s),this}removeListener(t,e,i=null,s=null){return this._eventBus.removeListener.call(this._eventBus,t,e,i,s),this}dispatchEvent(t,e,...i){return this._eventBus.dispatch(t,e,...i),this}_addConnection(t){this._connections.has(t)||(this._connections.add(t),t._setCanvas(this),this._drawElement(t),this.addListener(T.REMOVE,t,this._onElementRemove,this))}connect(t,e,i=null){return t=t instanceof yt?t:this.findShape(t),e=e instanceof yt?e:this.findShape(e),i instanceof ee||(i=Ae.create(Pe.CONNECTION,i)),!!i.connect(t,e)&&(this._addConnection(i),i)}trigger(t,...e){return this.dispatchEvent(t,this,...e)}clientToCanvas(t){const e=this._el;if(e){const i=e.getBoundingClientRect(),{x:s,y:n}=t;return{x:s-i.x,y:n-i.y}}return{x:0,y:0}}_connectToDragAreaBehavior(t,e={}){return this._draggingAreaBehavior&&(t?this._draggingAreaBehavior.setDragBehavior(t,e):this._draggingAreaBehavior.removeDragBehavior()),this}setResizingShape(t,e){const i=t&&t._resizeBehavior,s={direction:e};return this._connectToDragAreaBehavior(i,s)}setDraggingShape(t){const e=t&&t._dragBehavior;return this._connectToDragAreaBehavior(e)}setDraggingConnection(t,e=null){const i=t&&t._dragBehavior,s={draggingPoint:e};return this._connectToDragAreaBehavior(i,s)}getConnectivityAreaBehavior(){return this._connectivityAreaBehavior}startConnection(t){this._shapes.has(t)&&this._connectivityAreaBehavior.start(t)}startReconnection(t,e){let i;i=e===Pt.ORIG?t.getDestShape():t.getOrigShape(),this._connectivityAreaBehavior.start(i,t,e)}cancelConnection(){this._connectivityAreaBehavior.end()}completeConnection(t){this._shapes.has(t)&&this._connectivityAreaBehavior.complete(t)}selectItem(t){this._selectionBehavior.clear(),this._selectionBehavior.select(t)}getSelection(){return this._selectionBehavior.get()}onContextMenu(t){this._selectionBehavior.clear(),this._onContextMenu(t,this)}executeCommand(...t){const[e]=t,i=this._commandManager.executeCommand(...t);if(i){const i="string"==typeof e&&e||st.getProductKey(e);this._onChange(this,i,...t.slice(1))}return i}undo(){return this._commandManager.undo(),this._commandManager.getSteps()[0]}redo(){return this._commandManager.redo(),this._commandManager.getSteps()[1]}toJSON(){return{id:this.getID(),shapes:[...this._shapes].map(t=>t.toJSON()),connections:[...this._connections].map(t=>t.toJSON())}}_createElement(){if(this._el)return this;const t=r.createSVG("svg"),e=r.createSVG("g"),i=r.createSVG("g"),s=r.createSVG("g");return t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttribute("version","1.1"),t.setAttribute("class","canvas"),t.style.background="#F0F0F0",e.setAttribute("transform","scale(1, 1)"),e.append(i,s),t.appendChild(e),s.addEventListener("click",a,!1),s.addEventListener("dblClick",a,!1),i.addEventListener("click",a,!1),i.addEventListener("dblClick",a,!1),this._dom.uiLayer=s,this._dom.componentsLayer=i,this._el=t,this.setWidth(this._width).setHeight(this._height),this._selectionBehavior.attach(),this._connectivityAreaBehavior.attach(),this._draggingAreaBehavior.attach(),this._keyboardBehavior.attach(),this._contextMenuBehavior.attach(),this._shapes.forEach(t=>this._drawElement(t)),this._connections.forEach(t=>this._drawElement(t)),this.setID(this._id),super._createElement()}};const Le="0.1.0"}])}));
},{}],2:[function(require,module,exports){
const DrawJS = require('drawjs');
const { Canvas, Circle, Rectangle } = DrawJS;

const circleA = new Circle({
  id: "circleA",
  text: "Circle A",
  x: 49,
  y: 180,
  width: 60,
  height: 60,
});
const canvas = new Canvas({
  width: 1440,
  height: 900,
  // We can add shapes at Canvas' instantiating time in two manners: 
  // providing a Shape instance or by providing a Shape object descriptor.
  shapes: [
    circleA,
    {
      id: "rectB",
      type: "rectangle",
      text: "Rect B",
      data: {},
      x: 201.5,
      y: 180,
      width: 111,
      height: 80,
    }
  ],
  // We can create connection between Shapes by providing a Shape 
  // instance or a Shape id. Both of them should exist in Canvas.
  connections: [
    {
      orig: circleA,
      dest: 'rectB',
    }
  ],
  onChange: (...args) => {
    undoButton.disabled = false;
    redoButton.disabled = true;
  }
});

const rectC = new Rectangle({
  id: "rectC",
  type: "rectangle",
  text: "Rect C",
  data: {},
  x: 386,
  y: 180,
  width: 114,
  height: 80
});

// Also we can Add shapes after instantiating the Canvas.
canvas.addShape(rectC);
canvas.addShape({
  id: "circleD",
  type: "circle",
  text: "Circle D",
  data: {},
  x: 545,
  y: 180,
  width: 60,
  height: 60
});

// Connecting shapes is also possible after Canvas instantiation.
canvas.connect(rectC, 'circleD');
canvas.connect('rectB', rectC);

let undoButton;
let redoButton;
const undo = () => {
  undoButton.disabled = canvas.undo() === 0;
  redoButton.disabled = false;
};

const redo = () => {
  redoButton.disabled = canvas.redo() === 0;
  undoButton.disabled = false;
}

document.addEventListener('DOMContentLoaded', function () {
  undoButton = document.querySelector('#undo');
  redoButton = document.querySelector('#redo');
  let counter = 1;

  document.querySelector('#diagram').appendChild(canvas.getElement());
  undoButton.addEventListener('click', undo, false);
  redoButton.addEventListener('click', redo, false);

  document.querySelector('#add').addEventListener('click', () => {
    const selection = document.querySelector('#shape-selector').value;
    const position = { x: 50, y: 50 };
    let shape;

    switch (selection) {
      case 'Circle':
        shape = new Circle({
          text: `Circle #${counter}`,
          position,
        });
        break;
      case 'Rectangle':
        shape = new Rectangle({
          text: `Rectangle #${counter}`,
          position,
        });
        break;
      case 'Triangle':
        shape = new Triangle({
          text: `Triangle #${counter}`,
          position,
        });
        break;
      case 'Ellipse':
        shape = new Ellipse({
          text: `Ellipse #${counter}`,
          position,
        });
        break;
      default:
    }

    if (shape) {
      canvas.executeCommand(COMMANDS.SHAPE_ADD, canvas, shape);
      counter += 1;
    }
  }, false);

  document.querySelector('#data').addEventListener('click', () => {
    console.log(canvas.toJSON());
  }, false);

  // Here we add the undo/redo key binding.
  window.addEventListener('keydown', (event) => {
    switch (event.code) {
      case 'KeyZ':
        if (event.ctrlKey) {
          if (event.shiftKey) {
            redo();
          } else {
            undo();
          }
        }
        break;
    }
  }, false);
});
},{"drawjs":1}]},{},[2]);
